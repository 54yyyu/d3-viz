<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß¨ MEME Suite Lite - Bioinformatics Analysis</title>
    <script src="bundle.js"></script>
    <script src="memesuite-lite-js/memesuite-lite.js"></script>
    <style>
        /* Theme variables */
        :root {
            /* Dark theme (default) */
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #1e1e1e;
            --bg-quaternary: #0f0f0f;
            --text-primary: #ffffff;
            --text-secondary: #888;
            --accent-primary: #00d4ff;
            --accent-secondary: #ff6b6b;
            --border-color: #333;
            --input-bg: #333;
            --input-hover-bg: #555;
            --success-color: #4ecdc4;
            --warning-color: #ffa726;
            --error-color: #ef5350;
            --base-a-color: #ff6b6b;
            --base-c-color: #4ecdc4;
            --base-g-color: #45b7d1;
            --base-t-color: #96ceb4;
        }
        
        [data-theme="light"] {
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-quaternary: #f5f5f5;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent-primary: #0056b3;
            --accent-secondary: #dc3545;
            --border-color: #dee2e6;
            --input-bg: #e9ecef;
            --input-hover-bg: #dee2e6;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --error-color: #dc3545;
            --base-a-color: #d63031;
            --base-c-color: #00b894;
            --base-g-color: #0984e3;
            --base-t-color: #00a085;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr 60px;
            height: 100vh;
            gap: 1px;
            background: var(--bg-secondary);
        }
        
        .header {
            grid-column: 1 / -1;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-primary);
        }
        
        .theme-toggle {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .theme-toggle:hover {
            background: var(--input-hover-bg);
        }
        
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .main-panel {
            background: var(--bg-quaternary);
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .results-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .progress-bar {
            grid-column: 1 / -1;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            height: 60px;
        }
        
        /* Algorithm Tabs */
        .algorithm-tabs {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tabs-container {
            display: flex;
            gap: 5px;
        }
        
        .tab-btn {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .tab-btn:hover {
            background: var(--input-hover-bg);
        }
        
        .tab-btn.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }
        
        /* Input Sections */
        .input-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .input-section.hidden {
            display: none;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 15px;
        }
        
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px 20px;
            text-align: center;
            background: var(--bg-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
            transform: scale(1.02);
        }
        
        .upload-zone.has-file {
            border-color: var(--success-color);
            background: var(--bg-tertiary);
        }
        
        .upload-icon {
            font-size: 36px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .upload-text {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 10px;
        }
        
        .file-name {
            color: var(--success-color);
            font-weight: 500;
            font-size: 12px;
        }
        
        .file-input {
            display: none;
        }
        
        .textarea-input {
            width: 100%;
            min-height: 120px;
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .textarea-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }
        
        /* Parameter Controls */
        .param-group {
            margin-bottom: 20px;
        }
        
        .param-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: block;
        }
        
        .param-input {
            width: 100%;
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .param-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider {
            flex: 1;
            height: 4px;
            background: var(--input-bg);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Score threshold slider styling */
        #score-threshold::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
        }
        
        #score-threshold::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .slider-value {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 60px;
            text-align: right;
        }
        
        /* Action Buttons */
        .btn-group {
            padding: 15px 20px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            flex: 1;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--input-hover-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            gap: 20px;
        }
        
        .welcome-icon {
            font-size: 64px;
            color: var(--accent-primary);
        }
        
        .welcome-title {
            font-size: 24px;
            font-weight: 300;
            color: var(--text-primary);
        }
        
        .welcome-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            max-width: 500px;
            line-height: 1.5;
        }
        
        .results-area {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        
        .results-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }
        
        .results-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 5px;
        }
        
        .results-stats {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .results-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        /* Results Panel */
        .results-panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }
        
        .results-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-primary);
        }
        
        .visualization-area {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .viz-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }
        
        .viz-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 12px;
        }
        
        .logo-container {
            min-height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-secondary);
            overflow: hidden;
        }
        
        /* Progress Bar Components */
        .progress-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .progress-track {
            flex: 1;
            height: 6px;
            background: var(--input-bg);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--success-color));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 120px;
        }
        
        .progress-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--input-bg);
            border-top: 2px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Result Tables */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .results-table th,
        .results-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
        }
        
        .results-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--accent-primary);
        }
        
        .results-table tr:hover {
            background: var(--bg-tertiary);
        }
        
        .hit-row:hover {
            background: var(--input-hover-bg) !important;
            color: var(--text-primary) !important;
        }
        
        .score-high { color: var(--success-color); font-weight: 600; }
        .score-medium { color: var(--warning-color); font-weight: 500; }
        .score-low { color: var(--text-secondary); }
        
        /* FIMO Results Styling */
        .motif-result-section {
            transition: all 0.3s ease;
        }
        
        .motif-result-section.no-hits {
            opacity: 0.7;
        }
        
        .clickable-motif {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clickable-motif:hover {
            background: var(--input-hover-bg) !important;
            border-color: var(--accent-primary) !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.1);
        }
        
        .motif-sequences {
            animation: fadeIn 0.3s ease-out;
        }
        
        .sequence-display-item {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .sequence-display-item:hover {
            background: var(--input-hover-bg);
        }
        
        .nucleotide-highlight {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-radius: 3px;
            padding: 0 1px;
            box-shadow: 0 0 4px rgba(0, 212, 255, 0.3);
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .nucleotide-highlight:hover {
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }
        
        .fimo-controls {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .sequence-scroll-container {
            scrollbar-width: thin;
            scrollbar-color: var(--input-bg) var(--bg-secondary);
        }
        
        .sequence-scroll-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .sequence-scroll-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
        .sequence-scroll-container::-webkit-scrollbar-thumb {
            background: var(--input-bg);
            border-radius: 3px;
        }
        
        .sequence-scroll-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 280px 1fr 320px;
            }
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 260px 1fr 300px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 60px auto auto 1fr 60px;
            }
            
            .sidebar,
            .results-panel {
                max-height: 300px;
                overflow-y: auto;
            }
        }
        
        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--input-bg);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        /* Override LogoJS colors for theme support */
        [data-theme="dark"] .logo-container svg text {
            fill: #ffffff !important;
        }
        
        [data-theme="dark"] .logo-container svg line {
            stroke: #ffffff !important;
        }
        
        [data-theme="light"] .logo-container svg text {
            fill: #6c757d !important;
        }
        
        [data-theme="light"] .logo-container svg line {
            stroke: #6c757d !important;
        }
        
        /* Animation Effects */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* Example Data Buttons */
        .example-data {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .example-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .example-btn {
            width: 100%;
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-bottom: 5px;
            text-align: left;
            transition: all 0.2s ease;
        }
        
        .example-btn:hover {
            background: var(--input-hover-bg);
            border-color: var(--accent-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üß¨ MEME Suite Lite</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                üåô
            </button>
        </div>

        <!-- Left Sidebar - Input Controls -->
        <div class="sidebar">
            <!-- Algorithm Selection Tabs -->
            <div class="algorithm-tabs">
                <div class="tabs-container">
                    <button class="tab-btn active" data-algorithm="fimo" onclick="selectAlgorithm('fimo')">
                        FIMO
                    </button>
                    <button class="tab-btn" data-algorithm="tomtom" onclick="selectAlgorithm('tomtom')">
                        TOMTOM
                    </button>
                    <button class="tab-btn" data-algorithm="symmetric" onclick="selectAlgorithm('symmetric')">
                        Symmetric
                    </button>
                </div>
            </div>

            <!-- FIMO Input Section -->
            <div id="fimo-inputs" class="input-section">
                <div class="section-title">Motif File Upload</div>
                <div class="upload-zone" onclick="document.getElementById('fimo-motif-file').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        Click to upload or drag MEME file
                        <br><small>(.meme, .txt, .tsv formats)</small>
                    </div>
                    <div class="file-name" id="fimo-motif-name"></div>
                </div>
                <input type="file" id="fimo-motif-file" class="file-input" accept=".meme,.txt,.tsv" onchange="handleMotifFileUpload('fimo-motif', this)">

                <div class="section-title">Target Sequences</div>
                <textarea class="textarea-input" id="fimo-sequences" placeholder="Enter DNA sequences (FASTA format or plain sequences)...
Example:
>Sequence1
ACGTACGTACGTACGT
>Sequence2
TTTTAAAACCCCGGGG"></textarea>

                <div class="param-group">
                    <label class="param-label">P-value Threshold</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="fimo-threshold" min="-5" max="-1" step="0.1" value="-4" oninput="updateSliderValue('fimo-threshold-value', Math.pow(10, this.value).toExponential(1))">
                        <span class="slider-value" id="fimo-threshold-value">1.0e-4</span>
                    </div>
                </div>

                <div class="param-group">
                    <label class="param-label">
                        <input type="checkbox" id="fimo-rc" checked> Search reverse complement
                    </label>
                </div>
            </div>

            <!-- TOMTOM Input Section -->
            <div id="tomtom-inputs" class="input-section hidden">
                <div class="section-title">Query Motifs</div>
                <div class="upload-zone" onclick="document.getElementById('tomtom-query-file').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        Click to upload query MEME file
                        <br><small>(.meme, .txt, .tsv formats)</small>
                    </div>
                    <div class="file-name" id="tomtom-query-name"></div>
                </div>
                <input type="file" id="tomtom-query-file" class="file-input" accept=".meme,.txt,.tsv" onchange="handleMotifFileUpload('tomtom-query', this)">

                <div class="section-title">Target Database</div>
                <div class="upload-zone" onclick="document.getElementById('tomtom-target-file').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        Click to upload target MEME file
                        <br><small>(.meme, .txt, .tsv formats)</small>
                    </div>
                    <div class="file-name" id="tomtom-target-name"></div>
                </div>
                <input type="file" id="tomtom-target-file" class="file-input" accept=".meme,.txt,.tsv" onchange="handleMotifFileUpload('tomtom-target', this)">

                <div class="param-group">
                    <label class="param-label">Score Bins</label>
                    <input type="number" class="param-input" id="tomtom-score-bins" value="100" min="10" max="1000">
                </div>

                <div class="param-group">
                    <label class="param-label">Median Bins</label>
                    <input type="number" class="param-input" id="tomtom-median-bins" value="1000" min="100" max="5000">
                </div>

                <div class="param-group">
                    <label class="param-label">
                        <input type="checkbox" id="tomtom-rc" checked> Include reverse complement
                    </label>
                </div>
            </div>

            <!-- Symmetric TOMTOM Input Section -->
            <div id="symmetric-inputs" class="input-section hidden">
                <div class="section-title">Motif Database</div>
                <div class="upload-zone" onclick="document.getElementById('symmetric-file').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        Click to upload MEME file
                        <br><small>(.meme, .txt, .tsv formats)</small>
                    </div>
                    <div class="file-name" id="symmetric-name"></div>
                </div>
                <input type="file" id="symmetric-file" class="file-input" accept=".meme,.txt,.tsv" onchange="handleMotifFileUpload('symmetric', this)">

                <div class="param-group">
                    <label class="param-label">Score Bins</label>
                    <input type="number" class="param-input" id="symmetric-score-bins" value="100" min="10" max="1000">
                </div>

                <div class="param-group">
                    <label class="param-label">Median Bins</label>
                    <input type="number" class="param-input" id="symmetric-median-bins" value="1000" min="100" max="5000">
                </div>

                <div class="param-group">
                    <label class="param-label">
                        <input type="checkbox" id="symmetric-rc" checked> Include reverse complement
                    </label>
                </div>
            </div>

            <!-- Example Data Section -->
            <div class="example-data">
                <div class="example-title">Example Data</div>
                <button class="example-btn" onclick="loadExampleData('fimo')">
                    FIMO: JASPAR motifs + sequences
                </button>
                <button class="example-btn" onclick="loadExampleData('tomtom')">
                    TOMTOM: JASPAR TF comparison
                </button>
                <button class="example-btn" onclick="loadExampleData('symmetric')">
                    Symmetric: JASPAR database
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="btn-group">
                <button class="btn" onclick="runAnalysis()" id="run-btn">
                    Run Analysis
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    Clear All
                </button>
            </div>

            <!-- Export Section -->
            <div class="example-data" id="export-section" style="display: none;">
                <div class="example-title">Export Results</div>
                <button class="example-btn" onclick="exportResults('csv')">
                    üìä Export as CSV
                </button>
                <button class="example-btn" onclick="exportResults('json')">
                    üìÑ Export as JSON
                </button>
                <button class="example-btn" onclick="exportResults('tsv')">
                    üìã Export as TSV
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-panel">
            <div class="main-content">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcome-screen">
                    <div class="welcome-icon">üß¨</div>
                    <h2 class="welcome-title">MEME Suite Lite</h2>
                    <p class="welcome-subtitle">
                        Analyze biological sequences with FIMO (motif scanning), TOMTOM (motif comparison), 
                        and Symmetric TOMTOM (all-vs-all motif comparison). Upload your data and configure 
                        parameters in the left panel to get started.
                    </p>
                </div>

                <!-- Results Area -->
                <div class="results-area" id="results-area">
                    <div class="results-header">
                        <div class="results-title" id="results-title">Analysis Results</div>
                        <div class="results-stats" id="results-stats">Ready to display results</div>
                    </div>
                    <div class="results-content" id="results-content">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Visualizations -->
        <div class="results-panel">
            <div class="results-panel-header">
                <div class="results-panel-title">Visualizations</div>
            </div>
            <div class="visualization-area" id="visualization-area">
                <div class="viz-section">
                    <div class="viz-title">Sequence Logos</div>
                    <div class="logo-container" id="logo-container">
                        Select and run an analysis to view sequence logos
                    </div>
                </div>
                
                <div class="viz-section">
                    <div class="viz-title">Statistics</div>
                    <div id="stats-container">
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            No data to display
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-container">
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Ready</div>
                <div class="progress-spinner hidden" id="progress-spinner"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let memeSuite;
        let currentAlgorithm = 'fimo';
        let uploadedFiles = {};
        let analysisResults = {};
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            try {
                memeSuite = new MemeSuiteLite();
                console.log('MEME Suite Lite initialized:', memeSuite.version);
            } catch (error) {
                console.error('Failed to initialize MEME Suite Lite:', error);
                showError('Failed to initialize MEME Suite Lite. Please refresh the page.');
            }
            
            // Set up automatic theme detection
            setupAutoTheme();
            
            // Set up drag and drop handlers
            setupDragAndDrop();
            
            // Set up keyboard navigation
            setupKeyboardNavigation();
        });
        
        // Automatic theme setup
        function setupAutoTheme() {
            // Check if user has a preference stored, otherwise use system preference
            const storedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let initialTheme;
            if (storedTheme) {
                initialTheme = storedTheme;
            } else {
                initialTheme = systemPrefersDark ? 'dark' : 'light';
            }
            
            // Apply the initial theme
            const html = document.documentElement;
            html.setAttribute('data-theme', initialTheme);
            
            // Update toggle button
            const toggle = document.querySelector('.theme-toggle');
            toggle.textContent = initialTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                // Only auto-switch if user hasn't manually set a preference
                if (!localStorage.getItem('theme')) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    html.setAttribute('data-theme', newTheme);
                    toggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
                }
            });
        }
        
        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            
            // Store user's preference
            localStorage.setItem('theme', newTheme);
            
            const toggle = document.querySelector('.theme-toggle');
            toggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        }
        
        // Algorithm selection
        function selectAlgorithm(algorithm) {
            currentAlgorithm = algorithm;
            
            // Update tab appearance
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-algorithm') === algorithm) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide input sections
            document.querySelectorAll('.input-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(algorithm + '-inputs').classList.remove('hidden');
        }
        
        // File upload handling
        function handleMotifFileUpload(type, input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                // Validate MEME format
                if (!validateMemeFormat(content)) {
                    showError('Invalid MEME format. Please upload a valid MEME file (.meme/.txt/.tsv)');
                    input.value = ''; // Clear the input
                    return;
                }
                
                // Map fimo-motif back to fimo for compatibility
                const storageKey = type === 'fimo-motif' ? 'fimo' : type;
                uploadedFiles[storageKey] = content;
                
                // Update UI
                const nameElement = document.getElementById(type + '-name');
                if (nameElement) {
                    nameElement.textContent = file.name;
                    nameElement.parentElement.classList.add('has-file');
                }
                
                // Show file stats
                try {
                    const motifs = memeSuite.readMeme(content);
                    const motifCount = Object.keys(motifs).length;
                    nameElement.textContent = `${file.name} (${motifCount} motifs)`;
                } catch (error) {
                    nameElement.textContent = file.name;
                }
                
                console.log(`Uploaded ${storageKey}:`, file.name);
            };
            reader.readAsText(file);
        }
        
        // Validate MEME file format
        function validateMemeFormat(content) {
            if (!content || content.trim().length === 0) {
                return false;
            }
            
            // Check for MEME version header
            const lines = content.split('\n').map(line => line.trim());
            const hasVersion = lines.some(line => line.startsWith('MEME version'));
            const hasAlphabet = lines.some(line => line.startsWith('ALPHABET='));
            const hasMotif = lines.some(line => line.startsWith('MOTIF '));
            
            return hasVersion && hasAlphabet && hasMotif;
        }
        
        // Drag and drop setup
        function setupDragAndDrop() {
            document.querySelectorAll('.upload-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                zone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = this.parentElement.querySelector('.file-input');
                        fileInput.files = files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            });
        }
        
        // Keyboard navigation setup
        function setupKeyboardNavigation() {
            let currentMotifIndex = 0;
            let lastSelectedMotif = null; // Track the last clicked motif
            
            // Function to update current index based on selected motif
            window.updateCurrentMotifIndex = function(motifName) {
                // Get only visible motifs (respecting the filter)
                const visibleMotifElements = document.querySelectorAll('.motif-result-section:not([style*="display: none"])');
                const availableMotifs = Array.from(visibleMotifElements).map(element => {
                    // Find the actual motif name from the viz-title
                    const titleElement = element.querySelector('.viz-title span');
                    if (titleElement) {
                        return titleElement.textContent.replace('Motif: ', '');
                    }
                    return '';
                });
                
                // Find the index of the selected motif
                const motifIndex = availableMotifs.indexOf(motifName);
                if (motifIndex !== -1) {
                    currentMotifIndex = motifIndex;
                    lastSelectedMotif = motifName;
                }
            };
            
            document.addEventListener('keydown', function(e) {
                // Only handle arrow keys when results are displayed
                if (document.getElementById('results-area').style.display === 'none') return;
                
                // Get only visible motifs (respecting the filter)
                const visibleMotifElements = document.querySelectorAll('.motif-result-section:not([style*="display: none"])');
                const availableMotifs = Array.from(visibleMotifElements).map(element => {
                    // Find the actual motif name from the viz-title
                    const titleElement = element.querySelector('.viz-title span');
                    if (titleElement) {
                        return titleElement.textContent.replace('Motif: ', '');
                    }
                    return '';
                });
                
                if (availableMotifs.length === 0) return;
                
                if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    
                    // If we have a last selected motif, find its current index in visible motifs
                    if (lastSelectedMotif) {
                        const lastMotifIndex = availableMotifs.indexOf(lastSelectedMotif);
                        if (lastMotifIndex !== -1) {
                            currentMotifIndex = lastMotifIndex;
                            lastSelectedMotif = null; // Clear it after using
                        }
                    }
                    
                    if (e.key === 'ArrowUp') {
                        currentMotifIndex = Math.max(0, currentMotifIndex - 1);
                    } else if (e.key === 'ArrowDown') {
                        currentMotifIndex = Math.min(availableMotifs.length - 1, currentMotifIndex + 1);
                    }
                    
                    // Select the motif
                    const motifName = availableMotifs[currentMotifIndex];
                    selectMotif(motifName);
                    
                    // Scroll to the motif section
                    const motifElement = visibleMotifElements[currentMotifIndex];
                    if (motifElement) {
                        motifElement.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }
                }
            });
        }
        
        // Slider value updates
        function updateSliderValue(elementId, value) {
            document.getElementById(elementId).textContent = value;
        }
        
        // Example data loading
        function loadExampleData(type) {
            const examples = {
                fimo: {
                    motif: `MEME version 4

ALPHABET= ACGT

strands: + -

Background letter frequencies
A 0.25 C 0.25 G 0.25 T 0.25

MOTIF MA0004.1 Arnt
letter-probability matrix: alength= 4 w= 6 nsites= 20 E= 0
 0.200000  0.800000  0.000000  0.000000
 0.950000  0.000000  0.050000  0.000000
 0.000000  1.000000  0.000000  0.000000
 0.000000  0.000000  1.000000  0.000000
 0.000000  0.000000  0.000000  1.000000
 0.000000  0.000000  1.000000  0.000000
URL http://jaspar.genereg.net/matrix/MA0004.1

MOTIF TATA_BOX
letter-probability matrix: alength= 4 w= 8 nsites= 15 E= 0
0.1 0.8 0.05 0.05
0.2 0.1 0.1 0.6
0.1 0.05 0.05 0.8
0.1 0.7 0.1 0.1
0.4 0.2 0.2 0.2
0.6 0.15 0.15 0.1
0.3 0.3 0.2 0.2
0.2 0.4 0.2 0.2
URL BLANK
`,
                    sequences: `>Promoter1
GCATATAGCGCTATATAGCGATCGATCG
>Promoter2
ATCGATCGTATAAGCTATAGCGATCGAT
>Promoter3
CGATCGATCGATATACGCGCGCGCGCG
>Promoter4
TTTTAAAACCCCGGGGATATACCCGGG`
                },
                tomtom: {
                    query: `MEME version 4

ALPHABET= ACGT

strands: + -

Background letter frequencies
A 0.25 C 0.25 G 0.25 T 0.25

MOTIF MA0069.1 PAX6
letter-probability matrix: alength= 4 w= 14 nsites= 43 E= 0
 0.046512  0.093023  0.093023  0.767442
 0.046512  0.046512  0.000000  0.906977
 0.093023  0.604651  0.023256  0.279070
 0.906977  0.046512  0.023256  0.023256
 0.069767  0.790698  0.023256  0.116279
 0.023256  0.000000  0.953488  0.023256
 0.023256  0.860465  0.093023  0.023256
 0.488372  0.046512  0.046512  0.418605
 0.023256  0.093023  0.023256  0.860465
 0.046512  0.325581  0.581395  0.046512
 0.837209  0.000000  0.139535  0.023256
 0.255814  0.255814  0.302326  0.186047
 0.023256  0.116279  0.069767  0.790698
 0.023256  0.000000  0.395349  0.581395
URL http://jaspar.genereg.net/matrix/MA0069.1
`,
                    target: `MEME version 4

ALPHABET= ACGT

strands: + -

Background letter frequencies
A 0.25 C 0.25 G 0.25 T 0.25

MOTIF MA0071.1 RORA
letter-probability matrix: alength= 4 w= 10 nsites= 25 E= 0
 0.600000  0.040000  0.080000  0.280000
 0.360000  0.040000  0.000000  0.600000
 0.240000  0.480000  0.160000  0.120000
 0.440000  0.080000  0.200000  0.280000
 0.840000  0.000000  0.160000  0.000000
 0.000000  0.000000  1.000000  0.000000
 0.000000  0.000000  1.000000  0.000000
 0.000000  0.000000  0.000000  1.000000
 0.000000  1.000000  0.000000  0.000000
 1.000000  0.000000  0.000000  0.000000
URL http://jaspar.genereg.net/matrix/MA0071.1

MOTIF MA0074.1 RXRA::VDR
letter-probability matrix: alength= 4 w= 15 nsites= 10 E= 0
 0.300000  0.000000  0.700000  0.000000
 0.000000  0.000000  1.000000  0.000000
 0.000000  0.000000  0.900000  0.100000
 0.000000  0.000000  0.000000  1.000000
 0.000000  0.900000  0.000000  0.100000
 0.900000  0.000000  0.100000  0.000000
 0.400000  0.200000  0.000000  0.400000
 0.200000  0.400000  0.200000  0.200000
 0.200000  0.000000  0.800000  0.000000
 0.500000  0.000000  0.500000  0.000000
 0.000000  0.000000  1.000000  0.000000
 0.000000  0.000000  0.000000  1.000000
 0.100000  0.000000  0.000000  0.900000
 0.000000  0.900000  0.000000  0.100000
 0.700000  0.100000  0.200000  0.000000
URL http://jaspar.genereg.net/matrix/MA0074.1
`
                }
            };
            
            selectAlgorithm(type);
            
            if (type === 'fimo') {
                uploadedFiles['fimo'] = examples.fimo.motif;
                document.getElementById('fimo-motif-name').textContent = 'jaspar_fimo_example.meme (2 motifs)';
                document.querySelector('#fimo-motif-name').parentElement.classList.add('has-file');
                document.getElementById('fimo-sequences').value = examples.fimo.sequences;
            } else if (type === 'tomtom') {
                uploadedFiles['tomtom-query'] = examples.tomtom.query;
                uploadedFiles['tomtom-target'] = examples.tomtom.target;
                document.getElementById('tomtom-query-name').textContent = 'jaspar_query_pax6.meme (1 motif)';
                document.getElementById('tomtom-target-name').textContent = 'jaspar_targets.meme (2 motifs)';
                document.querySelector('#tomtom-query-name').parentElement.classList.add('has-file');
                document.querySelector('#tomtom-target-name').parentElement.classList.add('has-file');
            } else if (type === 'symmetric') {
                uploadedFiles['symmetric'] = examples.tomtom.target;
                document.getElementById('symmetric-name').textContent = 'jaspar_database.meme (2 motifs)';
                document.querySelector('#symmetric-name').parentElement.classList.add('has-file');
            }
        }
        
        // Main analysis function
        async function runAnalysis() {
            if (!memeSuite) {
                showError('MEME Suite Lite not initialized');
                return;
            }
            
            try {
                setLoading(true);
                updateProgress(0, 'Preparing analysis...');
                
                let results;
                
                if (currentAlgorithm === 'fimo') {
                    results = await runFimoAnalysis();
                } else if (currentAlgorithm === 'tomtom') {
                    results = await runTomtomAnalysis();
                } else if (currentAlgorithm === 'symmetric') {
                    results = await runSymmetricTomtomAnalysis();
                }
                
                analysisResults[currentAlgorithm] = results;
                displayResults(results);
                updateProgress(100, 'Analysis complete!');
                
                // Show export section
                document.getElementById('export-section').style.display = 'block';
                
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Analysis failed: ' + error.message);
            } finally {
                setLoading(false);
            }
        }
        
        // FIMO Analysis
        async function runFimoAnalysis() {
            if (!uploadedFiles['fimo']) {
                throw new Error('Please upload a motif file');
            }
            
            const sequences = document.getElementById('fimo-sequences').value
                .split('\n')
                .filter(line => line.trim() && !line.startsWith('>'))
                .map(line => line.trim().toUpperCase());
                
            if (sequences.length === 0) {
                throw new Error('Please enter target sequences');
            }
            
            updateProgress(20, 'Parsing motif file...');
            
            const threshold = Math.pow(10, document.getElementById('fimo-threshold').value);
            const reverseComplement = document.getElementById('fimo-rc').checked;
            
            updateProgress(40, 'Running FIMO scan...');
            
            const results = memeSuite.runFimo(uploadedFiles['fimo'], sequences, {
                threshold: threshold,
                reverseComplement: reverseComplement
            });
            
            updateProgress(80, 'Processing results...');
            
            return {
                algorithm: 'FIMO',
                motifs: Object.keys(memeSuite.readMeme(uploadedFiles['fimo'])).length,
                sequences: sequences.length,
                hits: results.reduce((total, motif) => total + motif.hits.length, 0),
                results: results,
                parameters: { threshold, reverseComplement }
            };
        }
        
        // TOMTOM Analysis
        async function runTomtomAnalysis() {
            if (!uploadedFiles['tomtom-query'] || !uploadedFiles['tomtom-target']) {
                throw new Error('Please upload both query and target motif files');
            }
            
            updateProgress(20, 'Parsing motif files...');
            
            const nScoreBins = parseInt(document.getElementById('tomtom-score-bins').value);
            const nMedianBins = parseInt(document.getElementById('tomtom-median-bins').value);
            const reverseComplement = document.getElementById('tomtom-rc').checked;
            
            updateProgress(60, 'Running TOMTOM comparison...');
            
            const results = memeSuite.runTomtom(
                uploadedFiles['tomtom-query'], 
                uploadedFiles['tomtom-target'], 
                {
                    nScoreBins: nScoreBins,
                    nMedianBins: nMedianBins,
                    reverseComplement: reverseComplement
                }
            );
            
            updateProgress(90, 'Processing results...');
            
            const queryMotifs = Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-query'])).length;
            const targetMotifs = Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-target'])).length;
            
            return {
                algorithm: 'TOMTOM',
                queryMotifs: queryMotifs,
                targetMotifs: targetMotifs,
                comparisons: queryMotifs * targetMotifs,
                results: results,
                parameters: { nScoreBins, nMedianBins, reverseComplement }
            };
        }
        
        // Symmetric TOMTOM Analysis
        async function runSymmetricTomtomAnalysis() {
            if (!uploadedFiles['symmetric']) {
                throw new Error('Please upload a motif database file');
            }
            
            updateProgress(20, 'Parsing motif database...');
            
            const nScoreBins = parseInt(document.getElementById('symmetric-score-bins').value);
            const nMedianBins = parseInt(document.getElementById('symmetric-median-bins').value);
            const reverseComplement = document.getElementById('symmetric-rc').checked;
            
            updateProgress(50, 'Running symmetric comparison...');
            
            // For symmetric TOMTOM, use the same file as both query and target
            const results = memeSuite.runTomtom(
                uploadedFiles['symmetric'], 
                uploadedFiles['symmetric'], 
                {
                    nScoreBins: nScoreBins,
                    nMedianBins: nMedianBins,
                    reverseComplement: reverseComplement
                }
            );
            
            updateProgress(90, 'Processing results...');
            
            const motifCount = Object.keys(memeSuite.readMeme(uploadedFiles['symmetric'])).length;
            
            return {
                algorithm: 'Symmetric TOMTOM',
                motifs: motifCount,
                comparisons: motifCount * motifCount,
                results: results,
                parameters: { nScoreBins, nMedianBins, reverseComplement }
            };
        }
        
        // Display results in the main panel
        function displayResults(results) {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('results-area').style.display = 'flex';
            
            const title = document.getElementById('results-title');
            const stats = document.getElementById('results-stats');
            const content = document.getElementById('results-content');
            
            title.textContent = results.algorithm + ' Results';
            
            if (results.algorithm === 'FIMO') {
                stats.textContent = `${results.motifs} motifs scanned against ${results.sequences} sequences ‚Ä¢ ${results.hits} hits found`;
                content.innerHTML = generateFimoResultsHTML(results);
            } else if (results.algorithm === 'TOMTOM') {
                stats.textContent = `${results.queryMotifs} query motifs vs ${results.targetMotifs} target motifs ‚Ä¢ ${results.comparisons} comparisons`;
                content.innerHTML = generateTomtomResultsHTML(results);
            } else if (results.algorithm === 'Symmetric TOMTOM') {
                stats.textContent = `${results.motifs} motifs ‚Ä¢ ${results.comparisons} pairwise comparisons`;
                content.innerHTML = generateSymmetricTomtomResultsHTML(results);
            }
            
            // Generate visualizations
            generateVisualizations(results);
        }
        
        // Generate FIMO results HTML
        function generateFimoResultsHTML(results) {
            let html = '<div class="fade-in">';
            
            // Add filter controls
            html += `
                <div class="fimo-controls" style="margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label style="display: flex; align-items: center; gap: 10px; font-size: 13px;">
                            <input type="checkbox" id="show-hits-only" onchange="toggleHitsOnlyFilter()" style="transform: scale(1.2);">
                            Show only motifs with hits
                        </label>
                        
                        <div style="display: flex; align-items: center; gap: 10px; font-size: 13px;">
                            <span style="min-width: 100px;">Score threshold:</span>
                            <input type="range" id="score-threshold" min="0" max="10" step="0.1" value="0" 
                                   onchange="updateScoreThreshold()" oninput="updateScoreThresholdValue(this.value)"
                                   style="flex: 1; height: 4px; background: var(--input-bg); border-radius: 2px; outline: none; cursor: pointer;">
                            <input type="number" id="score-threshold-input" min="0" max="10" step="0.1" value="0"
                                   onchange="updateScoreThresholdFromInput()" 
                                   style="width: 80px; background: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 4px; padding: 4px 8px; font-size: 12px;">
                        </div>
                    </div>
                </div>
            `;
            
            results.results.forEach((motifResult, index) => {
                const hasHits = motifResult.hits.length > 0;
                const motifId = `motif-${motifResult.motif_name.replace(/[^a-zA-Z0-9]/g, '_')}`;
                
                html += `
                    <div class="motif-result-section ${hasHits ? 'has-hits' : 'no-hits'}" id="${motifId}" style="margin-bottom: 20px;">
                        <div class="viz-section clickable-motif" onclick="selectMotif('${motifResult.motif_name}')" style="cursor: pointer; transition: all 0.2s ease;">
                            <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Motif: ${motifResult.motif_name}</span>
                                <span style="font-size: 11px; color: var(--text-secondary);">${motifResult.hits.length} hits</span>
                            </div>
                            ${!hasHits ? 
                                '<p style="color: var(--text-secondary); font-style: italic; margin: 10px 0;">No hits found</p>' :
                                `<div class="hits-summary" style="margin: 10px 0; font-size: 12px; color: var(--text-secondary);">
                                    Click to view logo and sequences
                                </div>`
                            }
                        </div>
                        
                        ${hasHits ? `
                            <div class="motif-sequences" id="sequences-${motifId}" style="display: none; margin-top: 15px;">
                                <div class="sequence-container" style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 6px; padding: 15px;">
                                    ${generateSequenceDisplay(motifResult)}
                                </div>
                                
                                <div class="hits-table-container" style="margin-top: 15px;">
                                    <table class="results-table">
                                        <thead>
                                            <tr>
                                                <th>Sequence</th>
                                                <th>Position</th>
                                                <th>Strand</th>
                                                <th>Score</th>
                                                <th>P-value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${motifResult.hits.map(hit => `
                                                <tr class="hit-row" data-sequence="${hit.sequence_idx}" onclick="highlightSequence(${hit.sequence_idx}, '${motifId}')" style="cursor: pointer;">
                                                    <td>Seq ${hit.sequence_idx + 1}</td>
                                                    <td>${hit.start}-${hit.end}</td>
                                                    <td>${hit.strand}</td>
                                                    <td class="${getScoreClass(hit.score)}">${hit.score.toFixed(3)}</td>
                                                    <td>${hit.p_value.toExponential(2)}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        // Generate TOMTOM results HTML
        function generateTomtomResultsHTML(results) {
            const queryNames = Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-query']));
            const targetNames = Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-target']));
            
            let html = '<div class="fade-in">';
            html += `
                <div class="viz-section">
                    <div class="viz-title">Motif Similarity Matrix</div>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Query</th>
                                <th>Target</th>
                                <th>P-value</th>
                                <th>Score</th>
                                <th>Offset</th>
                                <th>Overlap</th>
                                <th>Strand</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (let i = 0; i < results.results.pValues.length; i++) {
                for (let j = 0; j < results.results.pValues[i].length; j++) {
                    const pValue = results.results.pValues[i][j];
                    const score = results.results.scores[i][j];
                    const offset = results.results.offsets[i][j];
                    const overlap = results.results.overlaps[i][j];
                    const strand = results.results.strands[i][j] === 0 ? '+' : '-';
                    
                    html += `
                        <tr>
                            <td>${queryNames[i] || `Query ${i+1}`}</td>
                            <td>${targetNames[j] || `Target ${j+1}`}</td>
                            <td class="${getPValueClass(pValue)}">${pValue.toExponential(3)}</td>
                            <td class="${getScoreClass(score)}">${score.toFixed(3)}</td>
                            <td>${offset}</td>
                            <td>${overlap}</td>
                            <td>${strand}</td>
                        </tr>
                    `;
                }
            }
            
            html += `
                        </tbody>
                    </table>
                </div>
            </div>
            `;
            
            return html;
        }
        
        // Generate Symmetric TOMTOM results HTML
        function generateSymmetricTomtomResultsHTML(results) {
            const motifNames = Object.keys(memeSuite.readMeme(uploadedFiles['symmetric']));
            
            let html = '<div class="fade-in">';
            html += `
                <div class="viz-section">
                    <div class="viz-title">All vs All Motif Comparison</div>
                    <p style="margin-bottom: 15px; color: var(--text-secondary); font-size: 12px;">
                        Showing top similarities (excluding self-comparisons)
                    </p>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Motif 1</th>
                                <th>Motif 2</th>
                                <th>P-value</th>
                                <th>Score</th>
                                <th>Offset</th>
                                <th>Overlap</th>
                                <th>Strand</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Collect all comparisons and sort by p-value
            const comparisons = [];
            for (let i = 0; i < results.results.pValues.length; i++) {
                for (let j = 0; j < results.results.pValues[i].length; j++) {
                    if (i !== j) { // Exclude self-comparisons
                        comparisons.push({
                            i, j,
                            pValue: results.results.pValues[i][j],
                            score: results.results.scores[i][j],
                            offset: results.results.offsets[i][j],
                            overlap: results.results.overlaps[i][j],
                            strand: results.results.strands[i][j]
                        });
                    }
                }
            }
            
            // Sort by p-value and show top 20
            comparisons.sort((a, b) => a.pValue - b.pValue);
            
            comparisons.slice(0, 20).forEach(comp => {
                const strand = comp.strand === 0 ? '+' : '-';
                html += `
                    <tr>
                        <td>${motifNames[comp.i] || `Motif ${comp.i+1}`}</td>
                        <td>${motifNames[comp.j] || `Motif ${comp.j+1}`}</td>
                        <td class="${getPValueClass(comp.pValue)}">${comp.pValue.toExponential(3)}</td>
                        <td class="${getScoreClass(comp.score)}">${comp.score.toFixed(3)}</td>
                        <td>${comp.offset}</td>
                        <td>${comp.overlap}</td>
                        <td>${strand}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            </div>
            `;
            
            return html;
        }
        
        // Generate visualizations using LogoJS
        function generateVisualizations(results) {
            const logoContainer = document.getElementById('logo-container');
            const statsContainer = document.getElementById('stats-container');
            
            try {
                logoContainer.innerHTML = '';
                
                if (results.algorithm === 'FIMO') {
                    const motifs = memeSuite.readMeme(uploadedFiles['fimo']);
                    const motifNames = Object.keys(motifs);
                    
                    if (motifNames.length > 0) {
                        const firstMotif = motifs[motifNames[0]];
                        
                        // Create logo container
                        const logoDiv = document.createElement('div');
                        logoDiv.style.width = '100%';
                        logoDiv.style.height = '120px';
                        logoDiv.style.display = 'flex';
                        logoDiv.style.alignItems = 'center';
                        logoDiv.style.justifyContent = 'center';
                        logoContainer.appendChild(logoDiv);
                        
                        // Generate logo using LogoJS
                        if (window.logojs && window.logojs.embedDNALogo) {
                            // The PWM from memeSuite.readMeme is in [4 x length] format
                            // LogoJS expects [length x 4] format, so we need to transpose
                            const transposedPWM = [];
                            const motifLength = firstMotif[0].length;
                            
                            for (let pos = 0; pos < motifLength; pos++) {
                                transposedPWM.push([
                                    firstMotif[0][pos], // A
                                    firstMotif[1][pos], // C  
                                    firstMotif[2][pos], // G
                                    firstMotif[3][pos]  // T
                                ]);
                            }
                            
                            window.logojs.embedDNALogo(logoDiv, {
                                ppm: transposedPWM,
                                height: 120,
                                width: Math.min(400, motifLength * 25 + 100)
                            });
                        } else {
                            logoDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">LogoJS not available</div>';
                        }
                        
                        // Update title
                        logoContainer.parentElement.querySelector('.viz-title').textContent = `Sequence Logo: ${motifNames[0]}`;
                    }
                } else {
                    logoContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Motif comparison results - see main panel</div>';
                }
                
                // Update statistics
                statsContainer.innerHTML = generateStatsHTML(results);
                
            } catch (error) {
                console.error('Visualization error:', error);
                logoContainer.innerHTML = '<div style="color: var(--error-color); text-align: center; padding: 20px;">Error generating visualization</div>';
            }
        }
        
        // Generate statistics HTML
        function generateStatsHTML(results) {
            let html = '<div style="font-size: 12px; line-height: 1.5;">';
            
            if (results.algorithm === 'FIMO') {
                const totalHits = results.hits;
                const avgHitsPerMotif = totalHits / results.motifs;
                
                html += `
                    <div style="margin-bottom: 10px;">
                        <strong style="color: var(--accent-primary);">Summary</strong><br>
                        Total Hits: ${totalHits}<br>
                        Avg Hits/Motif: ${avgHitsPerMotif.toFixed(1)}<br>
                        Threshold: ${results.parameters.threshold.toExponential(1)}
                    </div>
                `;
            } else if (results.algorithm.includes('TOMTOM')) {
                const pValues = results.results.pValues.flat();
                const minPValue = Math.min(...pValues);
                const avgScore = results.results.scores.flat().reduce((a, b) => a + b, 0) / results.results.scores.flat().length;
                
                html += `
                    <div style="margin-bottom: 10px;">
                        <strong style="color: var(--accent-primary);">Summary</strong><br>
                        Best P-value: ${minPValue.toExponential(2)}<br>
                        Avg Score: ${avgScore.toFixed(3)}<br>
                        Score Bins: ${results.parameters.nScoreBins}
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // Utility functions for styling
        function getScoreClass(score) {
            if (score > 5) return 'score-high';
            if (score > 0) return 'score-medium';
            return 'score-low';
        }
        
        function getPValueClass(pValue) {
            if (pValue < 0.001) return 'score-high';
            if (pValue < 0.05) return 'score-medium';
            return 'score-low';
        }
        
        // Progress and loading functions
        function setLoading(loading) {
            const runBtn = document.getElementById('run-btn');
            const spinner = document.getElementById('progress-spinner');
            
            runBtn.disabled = loading;
            runBtn.textContent = loading ? 'Running...' : 'Run Analysis';
            
            if (loading) {
                spinner.classList.remove('hidden');
            } else {
                spinner.classList.add('hidden');
            }
        }
        
        function updateProgress(percent, text) {
            const fill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            fill.style.width = percent + '%';
            progressText.textContent = text;
            
            if (percent === 100) {
                setTimeout(() => {
                    fill.style.width = '0%';
                    progressText.textContent = 'Ready';
                }, 2000);
            }
        }
        
        // Error handling
        function showError(message) {
            const progressText = document.getElementById('progress-text');
            progressText.textContent = 'Error: ' + message;
            progressText.style.color = 'var(--error-color)';
            
            setTimeout(() => {
                progressText.textContent = 'Ready';
                progressText.style.color = '';
            }, 5000);
        }
        
        // Export functionality
        function exportResults(format) {
            if (!analysisResults[currentAlgorithm]) {
                showError('No results to export');
                return;
            }
            
            const results = analysisResults[currentAlgorithm];
            let content = '';
            let filename = `${currentAlgorithm.toLowerCase()}_results`;
            let mimeType = 'text/plain';
            
            try {
                if (format === 'csv' || format === 'tsv') {
                    const delimiter = format === 'csv' ? ',' : '\t';
                    content = convertToDelimited(results, delimiter);
                    mimeType = format === 'csv' ? 'text/csv' : 'text/tab-separated-values';
                    filename += `.${format}`;
                } else if (format === 'json') {
                    content = JSON.stringify(results, null, 2);
                    mimeType = 'application/json';
                    filename += '.json';
                }
                
                // Create and download file
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                updateProgress(100, `Exported as ${format.toUpperCase()}`);
                setTimeout(() => updateProgress(0, 'Ready'), 2000);
                
            } catch (error) {
                console.error('Export error:', error);
                showError('Export failed: ' + error.message);
            }
        }
        
        function convertToDelimited(results, delimiter) {
            let content = '';
            
            if (results.algorithm === 'FIMO') {
                // FIMO results format
                content = `Motif${delimiter}Sequence${delimiter}Start${delimiter}End${delimiter}Strand${delimiter}Score${delimiter}P-value\n`;
                
                results.results.forEach(motifResult => {
                    motifResult.hits.forEach(hit => {
                        content += `${motifResult.motif_name}${delimiter}Seq${hit.sequence_idx + 1}${delimiter}${hit.start}${delimiter}${hit.end}${delimiter}${hit.strand}${delimiter}${hit.score.toFixed(6)}${delimiter}${hit.p_value.toExponential(6)}\n`;
                    });
                });
                
            } else if (results.algorithm.includes('TOMTOM')) {
                // TOMTOM results format
                const queryMotifs = results.algorithm === 'Symmetric TOMTOM' 
                    ? Object.keys(memeSuite.readMeme(uploadedFiles['symmetric'])) 
                    : Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-query']));
                
                const targetMotifs = results.algorithm === 'Symmetric TOMTOM' 
                    ? Object.keys(memeSuite.readMeme(uploadedFiles['symmetric'])) 
                    : Object.keys(memeSuite.readMeme(uploadedFiles['tomtom-target']));
                
                content = `Query${delimiter}Target${delimiter}P-value${delimiter}Score${delimiter}Offset${delimiter}Overlap${delimiter}Strand\n`;
                
                for (let i = 0; i < results.results.pValues.length; i++) {
                    for (let j = 0; j < results.results.pValues[i].length; j++) {
                        const query = queryMotifs[i] || `Query${i+1}`;
                        const target = targetMotifs[j] || `Target${j+1}`;
                        const pValue = results.results.pValues[i][j];
                        const score = results.results.scores[i][j];
                        const offset = results.results.offsets[i][j];
                        const overlap = results.results.overlaps[i][j];
                        const strand = results.results.strands[i][j] === 0 ? '+' : '-';
                        
                        content += `${query}${delimiter}${target}${delimiter}${pValue.toExponential(6)}${delimiter}${score.toFixed(6)}${delimiter}${offset}${delimiter}${overlap}${delimiter}${strand}\n`;
                    }
                }
            }
            
            return content;
        }
        
        // Generate sequence display for motif results
        function generateSequenceDisplay(motifResult) {
            // Get unique sequences that have hits
            const hitSequences = new Set();
            motifResult.hits.forEach(hit => hitSequences.add(hit.sequence_idx));
            
            let html = '';
            
            // Get the sequences from the FIMO input
            const sequences = document.getElementById('fimo-sequences').value
                .split('\n')
                .filter(line => line.trim() && !line.startsWith('>'))
                .map(line => line.trim().toUpperCase());
            
            if (sequences.length === 0) return '<p style="color: var(--text-secondary);">No sequences available</p>';
            
            // Show only sequences with hits initially
            Array.from(hitSequences).sort((a, b) => a - b).forEach(seqIdx => {
                if (seqIdx < sequences.length) {
                    html += generateSingleSequenceDisplay(seqIdx, sequences[seqIdx], motifResult.hits);
                }
            });
            
            return html;
        }
        
        // Generate display for a single sequence with highlighted motifs
        function generateSingleSequenceDisplay(seqIdx, sequence, hits) {
            const nucleotides = ['A', 'C', 'G', 'T'];
            const baseClasses = ['base-A', 'base-C', 'base-G', 'base-T'];
            
            // Find hits for this sequence
            const sequenceHits = hits.filter(hit => hit.sequence_idx === seqIdx);
            
            let html = `
                <div class="sequence-display-item" data-sequence="${seqIdx}" style="margin-bottom: 20px; display: block;">
                    <div class="sequence-label" style="font-size: 12px; font-weight: 600; color: var(--accent-primary); margin-bottom: 8px;">
                        Sequence ${seqIdx + 1} (${sequenceHits.length} hits)
                    </div>
                    <div class="sequence-scroll-container" style="overflow-x: auto; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-quaternary);">
                        <div class="sequence-wrapper" style="display: flex; flex-direction: column; width: max-content; min-width: 100%;">
                            <div class="sequence-text" style="font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; white-space: nowrap; padding: 8px 10px;">
            `;
            
            // Create highlighted sequence
            for (let i = 0; i < sequence.length; i++) {
                const nucleotide = sequence[i];
                let baseIndex = nucleotides.indexOf(nucleotide);
                if (baseIndex === -1) baseIndex = 0; // Default to A if unknown
                
                // Check if this position is in any hit
                let isHighlighted = false;
                let hitInfo = null;
                
                for (const hit of sequenceHits) {
                    if (i >= hit.start && i < hit.end) {
                        isHighlighted = true;
                        hitInfo = hit;
                        break;
                    }
                }
                
                if (isHighlighted) {
                    html += `<span class="${baseClasses[baseIndex]} nucleotide-highlight" title="Hit: ${hitInfo.start}-${hitInfo.end}, Score: ${hitInfo.score.toFixed(3)}">${nucleotide}</span>`;
                } else {
                    html += `<span class="${baseClasses[baseIndex]}">${nucleotide}</span>`;
                }
                
                // Add space every 10 bases for readability
                if ((i + 1) % 10 === 0 && i + 1 < sequence.length) {
                    html += ' ';
                }
            }
            
            html += `
                            </div>
                            <div class="position-axis" style="font-family: 'Courier New', monospace; font-size: 10px; color: var(--text-secondary); padding: 4px 10px 8px 10px; white-space: nowrap; border-top: 1px solid var(--border-color);">
            `;
            
            // Generate position axis
            for (let i = 0; i < sequence.length; i++) {
                if (i % 10 === 0) {
                    const posStr = i.toString();
                    html += posStr.charAt(0);
                    
                    // Handle multi-digit numbers
                    for (let j = 1; j < posStr.length && i + j < sequence.length; j++) {
                        html += posStr.charAt(j);
                        i++;
                    }
                } else {
                    html += ' ';
                }
                
                // Add space every 10 bases to match sequence spacing
                if ((i + 1) % 10 === 0 && i + 1 < sequence.length) {
                    html += ' ';
                }
            }
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // Score threshold filtering
        function updateScoreThresholdValue(value) {
            document.getElementById('score-threshold-input').value = value;
        }
        
        function updateScoreThresholdFromInput() {
            const inputValue = parseFloat(document.getElementById('score-threshold-input').value);
            document.getElementById('score-threshold').value = inputValue;
            updateScoreThreshold();
        }
        
        function updateScoreThreshold() {
            applyFilters();
        }
        
        // Toggle hits-only filter
        function toggleHitsOnlyFilter() {
            applyFilters();
        }
        
        // Apply both filters (hits-only and score threshold)
        function applyFilters() {
            const showHitsOnly = document.getElementById('show-hits-only') ? document.getElementById('show-hits-only').checked : false;
            const scoreThreshold = parseFloat(document.getElementById('score-threshold') ? document.getElementById('score-threshold').value : 0);
            const motifSections = document.querySelectorAll('.motif-result-section');
            
            motifSections.forEach(section => {
                const hasHits = section.classList.contains('has-hits');
                
                // Check hits filter
                if (showHitsOnly && !hasHits) {
                    section.style.display = 'none';
                    return;
                }
                
                // Check score threshold filter
                if (hasHits && scoreThreshold > 0) {
                    // Find hits in this motif section that meet the score threshold
                    const hitRows = section.querySelectorAll('.hit-row');
                    let hasQualifyingHits = false;
                    
                    hitRows.forEach(row => {
                        const scoreCell = row.querySelector('.score-high, .score-medium, .score-low');
                        if (scoreCell) {
                            const score = parseFloat(scoreCell.textContent);
                            if (score >= scoreThreshold) {
                                hasQualifyingHits = true;
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    });
                    
                    // Hide motif if no hits meet the threshold
                    if (!hasQualifyingHits) {
                        section.style.display = 'none';
                        return;
                    }
                } else if (hasHits) {
                    // Show all hits if no score threshold
                    const hitRows = section.querySelectorAll('.hit-row');
                    hitRows.forEach(row => {
                        row.style.display = '';
                    });
                }
                
                // Show the section if it passed all filters
                section.style.display = 'block';
            });
        }
        
        // Extract motif URL from MEME file content
        function getMotifUrl(motifName) {
            if (!uploadedFiles['fimo']) return null;
            
            const memeContent = uploadedFiles['fimo'];
            const lines = memeContent.split('\n');
            
            // Find the motif by name
            let motifFound = false;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Look for the motif declaration
                if (line.startsWith('MOTIF ') && line.includes(motifName)) {
                    motifFound = true;
                    continue;
                }
                
                // If we found the motif, look for its URL
                if (motifFound && line.startsWith('URL ')) {
                    const url = line.replace('URL ', '').trim();
                    return url !== 'BLANK' ? url : null;
                }
                
                // If we hit another motif, stop searching
                if (motifFound && line.startsWith('MOTIF ') && !line.includes(motifName)) {
                    break;
                }
            }
            
            return null;
        }
        
        // Select motif and show in right panel
        function selectMotif(motifName) {
            // Update the current motif index for keyboard navigation
            if (window.updateCurrentMotifIndex) {
                window.updateCurrentMotifIndex(motifName);
            }
            
            // Get the motif PWM
            const motifs = memeSuite.readMeme(uploadedFiles['fimo']);
            const motifPWM = motifs[motifName];
            
            if (!motifPWM) {
                console.error('Motif not found:', motifName);
                return;
            }
            
            // Update visualization panel
            const logoContainer = document.getElementById('logo-container');
            const statsContainer = document.getElementById('stats-container');
            
            try {
                // Clear previous logo
                logoContainer.innerHTML = '';
                
                // Create logo container
                const logoDiv = document.createElement('div');
                logoDiv.style.width = '100%';
                logoDiv.style.height = '120px';
                logoDiv.style.display = 'flex';
                logoDiv.style.alignItems = 'center';
                logoDiv.style.justifyContent = 'center';
                logoContainer.appendChild(logoDiv);
                
                // Generate logo using LogoJS
                if (window.logojs && window.logojs.embedDNALogo) {
                    // The PWM from memeSuite.readMeme is in [4 x length] format
                    // LogoJS expects [length x 4] format, so we need to transpose
                    const transposedPWM = [];
                    const motifLength = motifPWM[0].length;
                    
                    for (let pos = 0; pos < motifLength; pos++) {
                        transposedPWM.push([
                            motifPWM[0][pos], // A
                            motifPWM[1][pos], // C  
                            motifPWM[2][pos], // G
                            motifPWM[3][pos]  // T
                        ]);
                    }
                    
                    window.logojs.embedDNALogo(logoDiv, {
                        ppm: transposedPWM,
                        height: 120,
                        width: Math.min(400, motifLength * 25 + 100)
                    });
                } else {
                    logoDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">LogoJS not available</div>';
                }
                
                // Update title
                logoContainer.parentElement.querySelector('.viz-title').textContent = `Sequence Logo: ${motifName}`;
                
                // Get motif URL
                const motifUrl = getMotifUrl(motifName);
                
                // Create clickable motif name if URL exists
                let motifNameDisplay;
                if (motifUrl) {
                    motifNameDisplay = `<a href="${motifUrl}" target="_blank" rel="noopener noreferrer" 
                        style="color: var(--accent-primary); text-decoration: none; cursor: pointer;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                        title="Click to view motif details">${motifName}</a>`;
                } else {
                    motifNameDisplay = motifName;
                }
                
                // Update stats
                statsContainer.innerHTML = `
                    <div style="font-size: 12px; line-height: 1.5;">
                        <div style="margin-bottom: 10px;">
                            <strong style="color: var(--accent-primary);">Selected Motif</strong><br>
                            Name: ${motifNameDisplay}<br>
                            Length: ${motifPWM[0].length} bp<br>
                            Type: DNA motif
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error generating motif visualization:', error);
                logoContainer.innerHTML = '<div style="color: var(--error-color); text-align: center; padding: 20px;">Error generating logo</div>';
            }
            
            // Toggle sequence display for this motif
            const motifId = `motif-${motifName.replace(/[^a-zA-Z0-9]/g, '_')}`;
            const sequencesDiv = document.getElementById(`sequences-${motifId}`);
            
            if (sequencesDiv) {
                // Hide all other sequence displays first
                document.querySelectorAll('.motif-sequences').forEach(div => {
                    if (div.id !== `sequences-${motifId}`) {
                        div.style.display = 'none';
                    }
                });
                
                // Toggle this one
                sequencesDiv.style.display = sequencesDiv.style.display === 'none' ? 'block' : 'none';
            }
            
            // Update clickable motif styles
            document.querySelectorAll('.clickable-motif').forEach(div => {
                div.style.background = '';
                div.style.borderColor = '';
            });
            
            const selectedMotifDiv = document.querySelector(`#${motifId} .clickable-motif`);
            if (selectedMotifDiv) {
                selectedMotifDiv.style.background = 'var(--bg-tertiary)';
                selectedMotifDiv.style.borderColor = 'var(--accent-primary)';
            }
        }
        
        
        // Highlight specific sequence when clicking on hit row
        function highlightSequence(seqIdx, motifId) {
            // Remove previous highlights
            document.querySelectorAll('.hit-row').forEach(row => {
                row.style.background = '';
            });
            
            document.querySelectorAll('.sequence-display-item').forEach(item => {
                item.style.background = '';
                item.style.border = '';
            });
            
            // Highlight selected row
            const selectedRow = document.querySelector(`.hit-row[data-sequence="${seqIdx}"]`);
            if (selectedRow) {
                selectedRow.style.background = 'var(--accent-primary)';
                selectedRow.style.color = 'var(--bg-primary)';
            }
            
            // Highlight corresponding sequence
            const sequenceItem = document.querySelector(`#sequences-${motifId} .sequence-display-item[data-sequence="${seqIdx}"]`);
            if (sequenceItem) {
                sequenceItem.style.background = 'var(--bg-tertiary)';
                sequenceItem.style.border = '2px solid var(--accent-primary)';
                sequenceItem.style.borderRadius = '6px';
                
                // Scroll into view
                sequenceItem.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'nearest'
                });
            }
        }
        
        // Clear all data
        function clearAll() {
            uploadedFiles = {};
            analysisResults = {};
            
            // Reset file uploads
            document.querySelectorAll('.file-input').forEach(input => {
                input.value = '';
            });
            
            document.querySelectorAll('.file-name').forEach(nameEl => {
                nameEl.textContent = '';
                nameEl.parentElement.classList.remove('has-file');
            });
            
            // Clear text areas
            document.querySelectorAll('.textarea-input').forEach(textarea => {
                textarea.value = '';
            });
            
            // Reset to welcome screen
            document.getElementById('welcome-screen').style.display = 'flex';
            document.getElementById('results-area').style.display = 'none';
            
            // Clear visualizations
            document.getElementById('logo-container').innerHTML = 'Select and run an analysis to view sequence logos';
            document.getElementById('stats-container').innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No data to display</div>';
            
            // Hide export section
            document.getElementById('export-section').style.display = 'none';
            
            updateProgress(0, 'Ready');
        }
    </script>
</body>
</html>